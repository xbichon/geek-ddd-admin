# 分页表格编程规范

## 1. 页面组件规范

### 1.1 完整代码示例

```vue
<template>
  <div class="user-management">
    <!-- 搜索区域 -->
    <el-card shadow="never" class="filter-card">
      <el-form :inline="true" :model="searchForm">
        <el-form-item label="姓名">
          <el-input v-model="searchForm.name" placeholder="请输入姓名" clearable />
        </el-form-item>
        <el-form-item label="状态">
          <el-select v-model="searchForm.status" placeholder="请选择状态" clearable>
            <el-option label="启用" value="enabled" />
            <el-option label="禁用" value="disabled" />
          </el-select>
        </el-form-item>
        <el-form-item>
          <el-button @click="handleReset">重置</el-button>
          <el-button type="primary" @click="handleSearch">搜索</el-button>
        </el-form-item>
      </el-form>
    </el-card>

    <!-- 表格区域 -->
    <el-card shadow="never" class="table-card">
      <el-table :data="tableData" v-loading="loading" fit>
        <el-table-column prop="id" label="ID" width="60" />
        <el-table-column prop="name" label="姓名" min-width="100" />
        <el-table-column prop="status" label="状态" width="80">
          <template #default="scope">
            <el-tag :type="scope.row.status === 'enabled' ? 'success' : 'danger'">
              {{ scope.row.status === 'enabled' ? '启用' : '禁用' }}
            </el-tag>
          </template>
        </el-table-column>
      </el-table>

      <!-- 分页 -->
      <el-pagination
        v-model:current-page="pagination.pageNum"
        v-model:page-size="pagination.pageSize"
        :page-sizes="[10, 20, 50]"
        :total="pagination.total"
        layout="total, sizes, prev, pager, next, jumper"
        @size-change="handleSizeChange"
        @current-change="handleCurrentChange"
      />
    </el-card>
  </div>
</template>

<script setup lang="ts">
import { ref, reactive, onMounted } from 'vue'
import { userService, type UserItem, type UserQuery } from '@/services/user'

// 状态管理
const loading = ref(false)
const initialSearchForm = { name: '', status: '' }
const initialSearchParams: UserQuery = { 
  name: undefined, 
  status: undefined, 
  pageNum: 1, 
  pageSize: 10 
}

// 三层数据结构
const searchForm = reactive({ ...initialSearchForm })     // 表单数据
const tableData = ref<UserItem[]>([])                     // 表格数据
const pagination = reactive({ pageNum: 1, pageSize: 10, total: 0 })
let searchParams: UserQuery = { ...initialSearchParams }  // 查询参数（非响应式）

// 数据获取
const fetchData = async () => {
  loading.value = true
  try {
    const res = await userService.getList(searchParams)
    tableData.value = res.records
    pagination.total = res.total
  } finally {
    loading.value = false
  }
}

// 搜索处理：点击搜索才更新查询条件
const handleSearch = () => {
  searchParams = {
    name: searchForm.name || undefined,
    status: searchForm.status || undefined,
    pageNum: 1,  // 搜索时重置页码
    pageSize: pagination.pageSize
  }
  fetchData()
}

// 重置处理
const handleReset = () => {
  Object.assign(searchForm, initialSearchForm)
  searchParams = { ...initialSearchParams }
  pagination.pageNum = 1
  fetchData()
}

// 分页处理
const handleSizeChange = (val: number) => {
  pagination.pageSize = val
  pagination.pageNum = 1
  searchParams = { ...searchParams, pageSize: val, pageNum: 1 }
  fetchData()
}

const handleCurrentChange = (val: number) => {
  pagination.pageNum = val
  searchParams = { ...searchParams, pageNum: val }
  fetchData()
}

onMounted(() => fetchData())
</script>
```

### 1.2 页面规范说明

#### 1.2.1 三层数据架构
分页表格采用三层数据管理模式：

```typescript
const searchForm = reactive({ name: '', status: '' })     // 表单数据 - 用户输入
const pagination = reactive({ pageNum: 1, pageSize: 10 }) // 分页数据 - UI状态
let searchParams = { name: undefined, status: undefined } // 查询参数 - API请求（非响应式）
```

#### 1.2.2 核心交互规范
- 搜索时重置页码到第1页
- 分页操作基于上次有效条件
- 使用标准分页参数：pageNum(从1开始) 和 pageSize

#### 1.2.3 表格列宽规范
根据内容特性选择合适的列宽属性：

| 场景 | 属性 | 说明 | 示例 |
|------|------|------|------|
| 固定宽度 | `width` | 内容长度固定的列 | ID、状态标签等 |
| 自适应宽度 | `min-width` | 内容长度变化的列 | 姓名、描述等 |

```vue
<!-- 推荐的表格配置 -->
<el-table :data="tableData" fit>
  <el-table-column prop="id" label="ID" width="60" />           <!-- 固定宽度 -->
  <el-table-column prop="name" label="姓名" min-width="100" />  <!-- 自适应宽度 -->
</el-table>
```

**关键要点：**
- 添加 `fit` 属性让列宽自适应容器
- 固定宽度适用于内容长度确定的字段
- 自适应宽度适用于内容长度不确定的字段

## 2. 服务层规范

### 2.1 完整代码示例

```typescript
// user.ts
import { fetchPage } from '@/utils/pagination'
import type { PageData, PageQuery } from '@/utils/pagination'

export interface UserQuery extends PageQuery {
  name?: string
  status?: string
}

export interface UserItem {
  id: number
  name: string
  status: string
}

export const userService = {
  getList: (query: UserQuery): Promise<PageData<UserItem>> =>
    fetchPage<UserItem, UserQuery>('/user/list', query)
}

// pagination/request.ts
import { http } from '@/utils/http'
import type { PageData, PageQuery } from './types'

export function fetchPage<T, Q extends PageQuery = PageQuery>(
  url: string, 
  query?: Q
): Promise<PageData<T>> {
  return http.get(url, { params: query })
}
```

### 2.2 服务层规范说明

#### 2.2.1 接口设计
- 查询参数继承 PageQuery 接口
- 使用标准分页响应结构 PageData<T>